{"version":3,"sources":["../src/services/offscreen/OffscreenExecutionService.ts"],"sourcesContent":["import { BrowserRuntimePostMessageStream } from '@metamask/post-message-stream';\n\nimport type { ExecutionServiceArgs } from '../AbstractExecutionService';\nimport { ProxyExecutionService } from '../proxy/ProxyExecutionService';\n\ntype OffscreenExecutionEnvironmentServiceArgs = {\n  offscreenPromise: Promise<unknown>;\n} & ExecutionServiceArgs;\n\nexport class OffscreenExecutionService extends ProxyExecutionService {\n  readonly #offscreenPromise: Promise<unknown>;\n\n  /**\n   * Create a new offscreen execution service.\n   *\n   * @param args - The constructor arguments.\n   * @param args.messenger - The messenger to use for communication with the\n   * `SnapController`.\n   * @param args.setupSnapProvider - The function to use to set up the snap\n   * provider.\n   * @param args.offscreenPromise - A promise that resolves when the offscreen\n   * environment is ready.\n   */\n  constructor({\n    messenger,\n    setupSnapProvider,\n    offscreenPromise,\n  }: OffscreenExecutionEnvironmentServiceArgs) {\n    super({\n      messenger,\n      setupSnapProvider,\n      stream: new BrowserRuntimePostMessageStream({\n        name: 'parent',\n        target: 'child',\n      }),\n    });\n\n    this.#offscreenPromise = offscreenPromise;\n  }\n\n  /**\n   * Create a new stream for the given job ID. This will wait for the offscreen\n   * environment to be ready before creating the stream.\n   *\n   * @param jobId - The job ID to create a stream for.\n   * @returns The stream for the given job ID.\n   */\n  protected async initEnvStream(jobId: string) {\n    await this.#offscreenPromise;\n\n    return await super.initEnvStream(jobId);\n  }\n}\n"],"mappings":";;;;;;;;;;AAAA,SAAS,uCAAuC;AAAhD;AASO,IAAM,4BAAN,cAAwC,sBAAsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcnE,YAAY;AAAA,IACV;AAAA,IACA;AAAA,IACA;AAAA,EACF,GAA6C;AAC3C,UAAM;AAAA,MACJ;AAAA,MACA;AAAA,MACA,QAAQ,IAAI,gCAAgC;AAAA,QAC1C,MAAM;AAAA,QACN,QAAQ;AAAA,MACV,CAAC;AAAA,IACH,CAAC;AAzBH,uBAAS,mBAAT;AA2BE,uBAAK,mBAAoB;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAgB,cAAc,OAAe;AAC3C,UAAM,mBAAK;AAEX,WAAO,MAAM,MAAM,cAAc,KAAK;AAAA,EACxC;AACF;AA1CW;","names":[]}